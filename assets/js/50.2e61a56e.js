(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{441:function(t,e,s){"use strict";s.r(e);var a=s(18),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"app-ideas-编程挑战"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#app-ideas-编程挑战"}},[t._v("#")]),t._v(" App Ideas 编程挑战")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/florinpop17/app-ideas",target:"_blank",rel:"noopener noreferrer"}},[t._v("app-ideas"),s("OutboundLink")],1),t._v("是 Github 上的一个开源编程挑战，意图在于为开发者提供一些练手的项目挑战。")]),t._v(" "),s("p",[t._v("为了提供预览功能，我在一个React项目中集成了各个挑战。"),s("a",{attrs:{href:"https://curlywater.github.io/app-ideas-challenge/",target:"_blank",rel:"noopener noreferrer"}},[t._v("项目入口"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("这篇文章记录实现项目中解决的问题和经验总结。")]),t._v(" "),s("h2",{attrs:{id:"自动生成项目列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动生成项目列表"}},[t._v("#")]),t._v(" 自动生成项目列表")]),t._v(" "),s("p",[t._v("所有项目自行维护目录集合在"),s("code",[t._v("projects")]),t._v("目录下。")]),t._v(" "),s("p",[t._v("自动生成项目列表，只需读取"),s("code",[t._v("projects")]),t._v("下的所有目录，获取信息，渲染超链接列表即可。")]),t._v(" "),s("p",[t._v("而在展示时，尽量减轻不必要的消耗，因此希望能动态加载模块。")]),t._v(" "),s("h3",{attrs:{id:"使用require-context获取目录下所有模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用require-context获取目录下所有模块"}},[t._v("#")]),t._v(" 使用"),s("code",[t._v("require.context")]),t._v("获取目录下所有模块")]),t._v(" "),s("p",[t._v("webpack提供的模块支持函数"),s("a",{attrs:{href:"https://webpack.docschina.org/guides/dependency-management/#require-with-expression",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("require.context")]),s("OutboundLink")],1),t._v("可以达到创建上下文（"),s("code",[t._v("context")]),t._v("）的效果。")]),t._v(" "),s("p",[t._v("创建上下文即生成一个上下文模块（"),s("code",[t._v("context module")]),t._v("），该模块引用指定目录中通过筛选的所有模块；并在内部维护一个map对象，记录模块定位符和模块id的对应关系。同时提供接口，支持开发者读取map对象信息。")]),t._v(" "),s("p",[t._v("在使用表达式定位符加载模块时，比如"),s("code",[t._v("require('./template/' + name + '.ejs');")]),t._v("，由于编译时无法确定具体模块，因此会创建一个上下文，等待运行时调用。这也导致所有可能用到的模块都被引入到bundle中。")]),t._v(" "),s("p",[t._v("而"),s("code",[t._v("require.context")]),t._v("，提供给开发者自行创建上下文的能力，并且可以设置模块加载的模式。")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" context "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" require"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  directory"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  includeSubdirs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Boolean "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 可选的，默认值是 true */")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" RegExp "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 可选的，默认值是 /^\\.\\/.*$/，所有文件 */")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 可选的， 'sync' | 'eager' | 'weak' | 'lazy' | 'lazy-once'，默认值是 'sync' */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[s("code",[t._v("require.context")]),t._v("返回一个导入函数，该函数有三个属性"),s("code",[t._v("resolve")]),t._v("、"),s("code",[t._v("keys")]),t._v("、"),s("code",[t._v("id")]),t._v("，")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("context(request)")]),t._v("：根据模块定位符导入对应模块")]),t._v(" "),s("li",[s("code",[t._v("context.resolve(request)")]),t._v("：返回模块对应的id")]),t._v(" "),s("li",[s("code",[t._v("context.keys()")]),t._v("：返回map中所有模块的id")]),t._v(" "),s("li",[s("code",[t._v("context.id")]),t._v("：上下文模块的id")])]),t._v(" "),s("p",[s("code",[t._v("mode")]),t._v("选项对应模块的加载方式：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("sync")]),t._v("：打包到当前chunk中，静态加载")]),t._v(" "),s("li",[s("code",[t._v("eager")]),t._v("：打包到当前chunk中，返回一个Promise")]),t._v(" "),s("li",[s("code",[t._v("lazy")]),t._v("：每个模块生成一个可延迟加载的chunk")]),t._v(" "),s("li",[s("code",[t._v("lazy-once")]),t._v("：将所有模块生成到一个可延迟加载的chunk中")])]),t._v(" "),s("h3",{attrs:{id:"懒加载模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#懒加载模块"}},[t._v("#")]),t._v(" 懒加载模块")]),t._v(" "),s("p",[t._v("需要满足两个需求：")]),t._v(" "),s("ul",[s("li",[t._v("项目列表中显示项目名称和描述信息")]),t._v(" "),s("li",[t._v("动态路由加载项目代码")])]),t._v(" "),s("p",[t._v("项目入口设计成一个overview结构。")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BorderRadiusPreviewer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  description"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"圆角生成器"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMain")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./App.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getReadme")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./README.md"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[t._v("这里的"),s("code",[t._v("getMain")]),t._v("和"),s("code",[t._v("getReadme")]),t._v("分别获取项目入口组件和项目描述，通过"),s("code",[t._v("import()")]),t._v("动态加载对应模块。\n尝试过定义一个"),s("code",[t._v("ProjectOverview")]),t._v("类供各组件使用，但存在"),s("code",[t._v("import()")]),t._v("依赖词法作用域定位模块的问题。")]),t._v(" "),s("p",[t._v("在路由部分，则是"),s("code",[t._v("React-Router")]),t._v("，"),s("code",[t._v("React.lazy")]),t._v("，"),s("code",[t._v("<Suspense>")]),t._v("三者搭配实现，也是"),s("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/code-splitting.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("代码分割"),s("OutboundLink")],1),t._v("部分的典型实践了。")]),t._v(" "),s("p",[s("strong",[s("a",{attrs:{href:"https://sourcegraph.com/github.com/curlywater/app-ideas-challenge/-/blob/src/App.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("项目对应代码"),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://webpack.docschina.org/api/module-methods/#requirecontext",target:"_blank",rel:"noopener noreferrer"}},[t._v("Webpack文档 —— require.context"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://webpack.docschina.org/guides/dependency-management",target:"_blank",rel:"noopener noreferrer"}},[t._v("Webpack文档 —— 依赖管理"),s("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=n.exports}}]);